<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="adoptr">
<title>Conditional Scores and Constraints â€¢ adoptr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conditional Scores and Constraints">
<meta property="og:description" content="adoptr">
<meta property="og:image" content="https://optad.github.io/adoptr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">adoptr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/adoptr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/adoptr_jss.html">Overview Paper</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/working-with-priors.html">Working with Priors</a>
    <a class="dropdown-item" href="../articles/conditional-scores.html">Conditional Scores</a>
    <a class="dropdown-item" href="../articles/composite-scores.html">Composite Scores</a>
    <a class="dropdown-item" href="../articles/defining-new-scores.html">Definining New Scores</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/optad/adoptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Conditional Scores and Constraints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/optad/adoptr/blob/HEAD/vignettes/conditional-scores.Rmd" class="external-link"><code>vignettes/conditional-scores.Rmd</code></a></small>
      <div class="d-none name"><code>conditional-scores.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/optad/adoptr" class="external-link">adoptr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="unconditional-scores-in-adoptr">(Un)conditional Scores in <strong>adoptr</strong><a class="anchor" aria-label="anchor" href="#unconditional-scores-in-adoptr"></a>
</h2>
<p>There are two fundamental ways of scoring a two-stage design: First,
one may assess the performance before observing any data, i.e., at the
planning stage. Classical examples for such scores would be power,
type-one-error rate, or expected sample size. There is, however, a
second perspective. After observing the stage-one outcome, one might be
inclined to consider conditional properties of a design. The most
prominent example being conditional power (probability to reject the
null under the alternative given stage-one outcome). We consider the
following example design</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TwoStageDesign-class.html">TwoStageDesign</a></span><span class="op">(</span></span>
<span>    n1        <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    c1f       <span class="op">=</span> <span class="fl">.0</span>,</span>
<span>    c1e       <span class="op">=</span> <span class="fl">2.0</span>,</span>
<span>    n2_pivots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    c2_pivots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">adoptr</span><span class="fu">:::</span><span class="fu">GaussLegendreRule</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">nodes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="va">x</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span></code></pre></div>
<p><img src="conditional-scores_files/figure-html/define-design-1.png" width="672"></p>
<p>In adoptr, scores are instances of their respective score class. The
most important ones are: <code>ConditionalScore</code>,
<code>UnconditionalScore</code>, and <code>IntegralScore</code>. An
object of class <code>ConditionalScore</code> can evaluate a design for
a particular stage-one outcome. A <code>ConditionalScore</code> is a
function <span class="math inline">\(s(\mathcal{D}, x_1)\)</span>
evaluating a design <span class="math inline">\(\mathcal{D}\)</span> at
a stage-one outcome <span class="math inline">\(X_1 = x_1\)</span>. Some
conditional scores might depend on the data distribution (conditional
power) others do not (conditional sample size). Conditional score
evaluation is completely vectorized:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uniform_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ContinuousPrior-class.html">ContinuousPrior</a></span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">.2</span>,</span>
<span>  support <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cp</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span><span class="op">(</span><span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">uniform_prior</span><span class="op">)</span></span>
<span><span class="va">css</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ConditionalSampleSize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">cp</span>, <span class="va">design</span>, <span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8312538 0.9303985 0.9772962</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">css</span>, <span class="va">design</span>, <span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 250 250 250</span></span></code></pre></div>
<p>Conditional scores can also be plotted directly for a given design by
including them in the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> call.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">design</span>, <span class="st">"Conditional Power"</span> <span class="op">=</span> <span class="va">cp</span><span class="op">)</span></span></code></pre></div>
<p><img src="conditional-scores_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Any conditional score can be integrated with respect to a prior and
data distribution to obtain an unconditional score. Note that for
conditional scores which depend on a specification of these
distributions (e.g., conditional power) these arguments must be
consistent! The resulting score is of class <code>IntegralScore</code>,
a specific subclass of <code>UnconditionalScore</code> and evaluates
designs independent of a particular <span class="math inline">\(x_1\)</span>, i.e., unconditionally</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span><span class="op">(</span><span class="va">cp</span>, <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">uniform_prior</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">ep</span>, <span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.989392</span></span></code></pre></div>
<p>Power at a point alternative can be obtained by forming the expected
value with respect to a point prior. For convenience, we include a
constructor for power directly, e.g., both variants are equivalent and
give power at <span class="math inline">\(0.4\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span><span class="op">(</span><span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">power2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">Power</a></span><span class="op">(</span><span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">power1</span>, <span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9967857</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">power2</span>, <span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9967857</span></span></code></pre></div>
<p>Similarly, <code>ExpectedSampleSize</code> is a shorthand constructor
for expected conditional sample size, i.e., the overall expected sample
size:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ess1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Scores.html">expected</a></span><span class="op">(</span><span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ConditionalSampleSize</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">uniform_prior</span><span class="op">)</span></span>
<span><span class="va">ess2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConditionalSampleSize-class.html">ExpectedSampleSize</a></span><span class="op">(</span><span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">uniform_prior</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">ess1</span>, <span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 134.9135</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Scores.html">evaluate</a></span><span class="op">(</span><span class="va">ess2</span>, <span class="va">design</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 134.9135</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conditional-constraints">Conditional Constraints<a class="anchor" aria-label="anchor" href="#conditional-constraints"></a>
</h2>
<p>The same syntax for constraint specification as for unconditional
constraints (power etc.) can be used for conditional scores
(e.g.Â conditional power) as well. Currently, these constraints apply to
the continuation area only. E.g.,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&gt;=</span> <span class="fl">0.7</span></span>
<span><span class="co">#&gt; -Pr[x2&gt;=c2(x1)|x1] (x1) &lt;= -0.7 for x1 in [c1f,c1e]</span></span></code></pre></div>
<p>imposes a constraint on the minimal conditional power upon
continuation. Inter-score comparisons are also supported, e.g.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&gt;=</span> <span class="fu"><a href="../reference/ConditionalPower-class.html">ConditionalPower</a></span><span class="op">(</span><span class="fu"><a href="../reference/NormalDataDistribution-class.html">Normal</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/PointMassPrior-class.html">PointMassPrior</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Pr[x2&gt;=c2(x1)|x1]  - Pr[x2&gt;=c2(x1)|x1] (x1) &lt;= 0 for x1 in [c1f,c1e]</span></span></code></pre></div>
<p>Would enforce that conditional power is always larger than
conditional error.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Kunzmann, Maximilian Pilz, Jan Meis, Nico Bruder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
